

<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
  
  <title>使用vibrate api在移动设备上发出震动 | ForeverYoung</title>
  <meta name="author" content="BeYoung">
  
  <meta name="description" content="Just another weblog.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="使用vibrate api在移动设备上发出震动"/>
  <meta property="og:site_name" content="ForeverYoung"/>

  
    <meta property="og:image" content="http://beyoung.me/images/gravatar.png"/>
  

  <link href="/favicon.png" rel="icon">

  <link rel="alternate" href="/atom.xml" title="ForeverYoung" type="application/atom+xml">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="http://cdn.staticfile.org/jquery/2.1.1-rc2/jquery.min.js"></script>
  
  
</head>


<body>
    <div class="container">
      <div class="left-col">
        <div class="intrude-less">
          <header id="header" class="inner">
            <div class="profilepic">
  <img src="/images/gravatar.png"/>
</div><!-- profilepic -->
<h1><a href="/">BeYoung</a></h1>
<p class="subtitle">Remember, Let go, Move on.</p>
<nav id="main-nav">
  <ul class="main">
    
      <li>
      <a href="/">Blog</a>
      </li>
    
      <li>
      <a href="/archives">Archives</a>
      </li>
    
      <li>
      <a href="/project">Project</a>
      </li>
    
      <li>
      <a href="/about">About</a>
      </li>
    
  </ul>
  
  <section class="aboutme">
    <p>
      Just another weblog.
    </p>
  </section>
  
</nav><!-- main-nav -->
<nav id="sub-nav">
  <div class="social">
    
      <a class="weibo" href="http://weibo.com/710200711"
         title="weibo">weibo</a>
    
    
      <a class="google" href="http://plus.google.com/114027670572929172581"
         title="Google+">Google+</a>
    
    
      <a class="github" href="http://github.com/xuhong"
         title="Github">Github</a>
    
    
        <a class="rss" href="/atom.xml" title="RSS">RSS</a>
    
  </div>
</nav><!-- sub-nav -->
<!--nav id="widget-nav">
  <div class="widgets">
    
      
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/HTML5/">HTML5</a><small>6</small></li>
  
    <li><a href="/tags/Life/">Life</a><small>1</small></li>
  
    <li><a href="/tags/algorithm/">algorithm</a><small>1</small></li>
  
    <li><a href="/tags/blog/">blog</a><small>1</small></li>
  
    <li><a href="/tags/css3/">css3</a><small>1</small></li>
  
    <li><a href="/tags/file_api/">file_api</a><small>1</small></li>
  
    <li><a href="/tags/flexbox/">flexbox</a><small>1</small></li>
  
    <li><a href="/tags/fullscreen/">fullscreen</a><small>1</small></li>
  
    <li><a href="/tags/geolocation/">geolocation</a><small>1</small></li>
  
    <li><a href="/tags/gevent/">gevent</a><small>1</small></li>
  
    <li><a href="/tags/inherit/">inherit</a><small>1</small></li>
  
    <li><a href="/tags/javascript/">javascript</a><small>2</small></li>
  
    <li><a href="/tags/notification/">notification</a><small>1</small></li>
  
    <li><a href="/tags/python/">python</a><small>2</small></li>
  
    <li><a href="/tags/source/">source</a><small>1</small></li>
  
    <li><a href="/tags/thought/">thought</a><small>1</small></li>
  
    <li><a href="/tags/touch_event/">touch_event</a><small>1</small></li>
  
    <li><a href="/tags/vibrate/">vibrate</a><small>1</small></li>
  
    <li><a href="/tags/zepto/">zepto</a><small>2</small></li>
  
  </ul>
</div>


    
  </div>
</nav--><!-- widget-nav -->

          <header>
        </div><!-- intrude-less -->
      </div><!-- left-col -->
      <div class="mid-col">
        <div class="mid-col-container">
      <div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  
	<!--div class="meta">
          
<div class="date">

<time datetime="2014-05-26T10:39:43.000Z"
      
      data-updated="true"
       itemprop="datePublished">
  May 26 2014
</time>





</div>

	</div-->

        <h1 class="title" itemprop="name">使用vibrate api在移动设备上发出震动<div class="menu">
          <i class="icon-list"></i>
          <i class="icon-expand"></i>
        </div></h1>
      	<div class="entry-content" itemprop="articleBody"><p>前两天写了<a href="http://beyoung.me/2014/05/22/notification/">Notification API</a>的使用，后来一想，这个提醒对桌面的意义其实要大于移动设备，比如chrome为此专门建立一个消息中心的扩展。对移动设备而言，这种消息提醒并不能引起注意，当手机装在口袋的时候，我们并不能及时的收到提醒。那么移动设备是怎么提醒我们的呢？——使用铃声和震动。然后发现HTML5真有一个震动的API——vibrate。</p>
<h3>如何使用</h3>
<p>vibrate API的使用非常简单，无需申请权限，这一点其实也有待商议，是否会骚扰用户？</p>
<h4>检测支持</h4>
<p>因为无需申请权限，其实这一步就可有可无了，不支持的话就让它静默的失败就好了：</p>
<pre><code><span class="keyword">var</span> supportVibrate = <span class="string">"vibrate"</span> <span class="keyword">in</span> navigator;</code></pre>
<p><a id="more"></a></p>
<h4>发出震动</h4>
<p>下面的代码将发起1s的震动：</p>
<pre><code>navigator<span class="preprocessor">.vibrate</span>(<span class="number">1000</span>)<span class="comment">;</span></code></pre>
<p>下面的代码将先震动1s，再静止0.5s，再震动1s……这个频率来电震动是一样的：</p>
<pre><code>navigator<span class="preprocessor">.vibrate</span>([<span class="number">1000</span>, <span class="number">500</span>, <span class="number">1000</span>, <span class="number">500</span>, <span class="number">1000</span>, <span class="number">5000</span>])<span class="comment">;</span></code></pre>
<h4>清除震动</h4>
<p>下面两种方法都可以清除震动：</p>
<pre><code>navigator<span class="preprocessor">.vibrate</span>(<span class="number">0</span>)<span class="comment">;</span>
navigator<span class="preprocessor">.vibrate</span>([])<span class="comment">;</span></code></pre>
<h4>持续震动</h4>
<p>可以通过使用setInterval和clearInterval来实现：</p>
<pre><code>var vibrateInterval;

<span class="function"><span class="keyword">function</span> <span class="title">startVibrate</span><span class="params">(duration)</span> {</span>
    <span class="transposed_variable">navigator.</span>vibrate(duration);
}

<span class="function"><span class="keyword">function</span> <span class="title">stopVibrate</span><span class="params">()</span> {</span>
    <span class="keyword">if</span>(vibrateInterval) clearInterval(vibrateInterval);
    <span class="transposed_variable">navigator.</span>vibrate();
}

<span class="function"><span class="keyword">function</span> <span class="title">peristVibrate</span><span class="params">(duration, interval)</span> {</span>
    vibrateInterval = setInterval(<span class="keyword">function</span>()<span class="cell">{
            startVibrate(duration);
        }</span>, interval);
}</code></pre>
<h3>例子</h3>
<button>vibrate once</button><br><button>vibrate like calling</button><br><button>perist vibrate</button><br><button>stop vibrate</button>

<h3>兼容</h3>
<p>IE系列都不兼容，chrome和firefox最新版本都兼容：<br><img src="/img/post/caniusevibrate.png" alt="caniuse vibrate"></p>
<h3>BUG</h3>
<ol>
<li><p>这个api不能和<code>visibilityState</code>组合使用，我在android chorme35上测试，监听<code>visibilityChange</code>事件，当它发生变化时就发出震动：</p>
<pre><code> document<span class="preprocessor">.addEventListener</span>(<span class="string">"visibilityChange"</span>, peristVibrate())<span class="comment">;</span></code></pre>
<p> 这段代码导致chrome上震动出现异常，变成那种很轻微的抽搐似的震动。。firefox则不受影响。</p>
</li>
<li><p><code>navigator.vibrate([1000,500,1000,500])</code>这种方式的震动在firefox上是不能被取消的，因为它自己在震动结束后会自动取消，所以上面提到的两种取消震动的方式对它都没用。但在chrome上却是可以取消的，不过需要一一对应，也就是说<code>navigator.vibrate([1000,500,1000,500])</code>需要<code>navigator.vibrate([])</code>来取消，<code>navigator.vibrate(1000)</code>需要<code>navigator.vibrate()</code>来取消。</p>
</li>
</ol>
<h3>展望</h3>
<p>这个API是纯粹的为移动设备而存在的，尤其是基于browser的实时web app，如游戏、聊天，但现在这个API还远不够好玩，因为在<code>visibilityState</code>为<code>false</code>的时候浏览器会自动取消震动，出于对移动设备耗电的考虑。这样的话，想用这个api来进行提醒的目的就达不到了。但对于web app游戏而言还是有用处的，可以使用它大大的提高用户体验。等将来移动设备的性能越来越好，移动网络越来越快，浏览器的生态系统更加完善的时候，基本上所有的独立应用都可以不需要了，游戏、聊天等都可以在浏览器中进行，不过这貌似得很久很久以后了。。。突然想到，话说现在不是各种智能设备炒得火热么？前端工程师是不是也可以做个智能震动棒啥的了。。。</p>
<h3>参考资料</h3>
<p>w3c: <a href="http://www.w3.org/TR/vibration/" target="_blank">vibrate api</a><br>david walsh blog: <a href="http://davidwalsh.name/vibration-api" target="_blank">vibrate api</a><br>Terence Eden&#39;s Blog: <a href="http://shkspr.mobi/blog/2014/01/malicious-use-of-the-html5-vibrate-api/" target="_blank">Malicious Use of the HTML5 Vibrate API</a><br>caniuse: <a href="http://caniuse.com/#feat=vibration" target="_blank">vibrate</a></p>
<script>
    var vibrateInterval;

    function startVibrate(duration) {
        navigator.vibrate(duration);
    }

    function stopVibrate() {
        if(vibrateInterval) clearInterval(vibrateInterval);
        navigator.vibrate();
    }

    function peristVibrate(duration, interval) {
        vibrateInterval = setInterval(function(){
                startVibrate(duration);
            }, interval);
    }
    var con = document.getElementById('content'),
        btn = con.getElementsByTagName('button');
    btn[0].addEventListener('click',function(){
        startVibrate(1000);
    });
    btn[1].addEventListener('click', function(){
        startVibrate([1000, 500, 1000, 500, 1000, 500, 1000, 500, 1000, 500, 1000, 500]);
    });
    btn[2].addEventListener('click', function(){
        peristVibrate(1000,500);
    });
    btn[3].addEventListener('click', function(){
        stopVibrate();
    });

</script></div>
        <script src="/js/article.js"></script>


</article>

  <!--div class="share">
  <div class="addthis_toolbox addthis_default_style ">
  
  
  
  <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
  
  
  </div>
  <script type="text/javascript">
    var addthis_config = {"data_track_addressbar":true};
  </script>
  <script type="text/javascript"
          src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=undefined">
  </script>
</div-->



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the
  <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>

<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
<div class="ds-thread"></div></div>
</section>

</div>
  </div>
        <footer id="footer" class="inner">
          Copyright © 2013  BeYoung 

        </footer>
        
<script src="/js/slash.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
  var disqus_shortname = 'beyoungme';

  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
  </script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>




      </div><!-- mid-col -->
    </div><!-- container -->
</body>
</html>

